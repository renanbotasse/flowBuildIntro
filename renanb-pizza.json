{
	"name": "renanb-pizza",
	"description": "Desafio do pedido de Pizza - Renan B",
	"blueprint_spec": {
		"requirements": ["core"],
		"prepare": [],
		"environment": {},
		"lanes": [
			{
				"id": "user",
				"name": "para todos os usuários",
				"rule": []
			},
			{
				"id": "pizzaria",
				"name": "para a pizzaria",
				"rule": []	
			}
		],
		"nodes": [
			{
				"id": "Start",
				"name": "Start renanb-pizza",
				"next": "ACESSAR APP DA PIZZARIA",
				"type": "start",
				"lane_id": "user",
				"parameters": {
						"input_schema": {}
						}
			},
			{
				"id": "ACESSAR APP DA PIZZARIA",
				"name": "Abrir o APP",
				"next": "ESCOLHER PIZZA",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "ACESSAR_APP",
					"input": {}
					}
			},
			{
				"id": "ESCOLHER PIZZA",
				"name": "Selecionar pizza",
				"next": "GUARDAR O PEDIDO",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "escolher_pizza",
					"input": {
						"menu": { "$ref": "bag.menu" }
					}
					}
			},
			{
				"id": "GUARDAR O PEDIDO",
				"name": "Guardar o pedido",
				"next": "QUER ALTERAR INGREDIENTES?",
				"lane_id": "user",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza"
				  }
				}
			},
			{
				"id": "QUER ALTERAR INGREDIENTES?",
				"name": "Alterar algum ingrediente?",
				"next": {
				  "default": "QUER COMENTAR?",
				  "true": "QUER COMENTAR?",
				  "false": "EDITAR INGREDIENTES?"
				},
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.ingredientes"
					  }
					}
				}
			},
			{
				"id": "EDITAR INGREDIENTES?",
				"name": "Editar ingredientes?",
				"next": "QUER COMENTAR?",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "editar_ingredientes",
					"input": {
						"ingredientes_pizza": {"$ref": "bag.pizza.ingredientes"}					}
					}
			},
			{
				"id": "QUER COMENTAR?",
				"name": "Quer fazer algum comentário?",
				"next": {
					"default": "ESCOLHER LOCAL DE ENTREGA",
					"true": "ESCOLHER LOCAL DE ENTREGA",
					"false": "FAZER COMENTÁRIO"
				  },
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.comentario"
					  }
					}
				}
			},
			{
				"id": "FAZER COMENTÁRIO",
				"name": "Adicionar comentário",
				"next": "ESCOLHER LOCAL DE ENTREGA",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "add_comentario",
					"input": {
						"comentarios_pizza": {"$ref": "bag.pizza.comentario"}					}
					}
			},
			{
				"id": "ESCOLHER LOCAL DE ENTREGA",
				"name": "Definir local de entrega",
				"next": "ESCOLHER FORMA DE PAGAMENTO/TROCO",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "selecionar_entrega",
					"input": {
						"endereco_pizza": {"$ref": "bag.pizza.endereco"}					}
					}
			},
			{
				"id": "ESCOLHER FORMA DE PAGAMENTO/TROCO",
				"name": "Escolher forma de pagamento",
				"next": "REVISAR PEDIDO E CONFIRMAR",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "definir_formato_pagamento",
					"input": {
						"formadepagamento_pizza": {"$ref": "bag.pizza.pagamento"}					}
					}
			},
			{
				"id": "REVISAR PEDIDO E CONFIRMAR",
				"name": "Revisão do pedido",
				"next": "QUER EDITAR O PEDIDO?",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "revisar_pedido",
					"input": {
						"pedido_pizza": {"$ref": "bag.pizza"}					
					}
					}
			},
			{
				"id": "QUER EDITAR O PEDIDO?",
				"name": "Quer alterar o pedido?",
				"next": {
					"default": "PAGAMENTO VAI SER FEITO PELO APP?",
					"true": "PAGAMENTO VAI SER FEITO PELO APP?",
					"false": "ESCOLHER PIZZA"
					  },
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
			        "key": {
						"$ref": "bag.pizza"
					  }
					  }
					}
			},
			{
				"id": "PAGAMENTO VAI SER FEITO PELO APP?",
				"name": "Vai pagar pelo aplicativo?",
				"next": {
					"default": "PAGAR PELO APP",
					"true": "PAGAR PELO APP",
					"false": "ENVIAR O PEDIDO PARA PIZZARIA"
					  },
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.pagamento"
					  }
					  }
					}
			},
			{
				"id": "PAGAR PELO APP",
				"name": "Pagar pelo APP",
				"next": "ENVIAR O PEDIDO PARA PIZZARIA",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "pagar",
					"input": {
						"pagamento_pizza": {"$ref": "bag.pizza.pagamento"}					}
					}
			},
			{
				"id": "ENVIAR O PEDIDO PARA PIZZARIA",
				"name": "Enviar pedido",
				"next": {
					"default": "TEMPO MÉDIO PARA ENTREGA",
					"true": "TEMPO MÉDIO PARA ENTREGA",
					"false": "CHECK STATUS"
					  },
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.status"
					  }
					  }
					}
			},
			{
				"id": "CHECK STATUS",
				"name": "Verificar posição do pedido",
				"next": "QUER CANCELAR?",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "check_status",
					"input": {
						"status_pizza": {"$ref": "bag.pizza.status"}					}
					}
			},
			{
				"id": "QUER CANCELAR?",
				"name": "Quer cancelar o pedido?",
				"next": {
					"default": "ENTREGADOR CHEGOU?",
					"true": "ENTREGADOR CHEGOU?",
					"false": "PEDIDO JÁ FOI ACEITO?"
					  },
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.status"
					  }
					  }
					}
			},
			{
				"id": "PEDIDO JÁ FOI ACEITO?",
				"name": "Pedido aceito ou não?",
				"next": {
					"default": "NÃO É POSSÍVEL CANCELAR",
					"true": "NÃO É POSSÍVEL CANCELAR",
					"false": "JÁ FOI PAGO? - cliente"
					  },
				"type": "flow",
				"lane_id": "pizzaria",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.status"
					  }
					  }
					}
			},
			{
				"id": "JÁ FOI PAGO? - cliente",
				"name": "any string",
				"next": {
					"default": "FINISH - Cliente cancelou sem reembolso",
					"true": "FINISH - Cliente cancelou sem reembolso",
					"false": "REEMBOLSO - cliente cancelou"
					  },
				"type": "flow",
				"lane_id": "pizzaria",
				"parameters": {
				  "input": {
					"key": {
					"$ref": "bag.pizza.pagamento"
				}
				  }
					}
			},
			{
				"id": "REEMBOLSO - cliente cancelou",
				"name": "Reembolsar (cliente pediu cancelamento)",
				"next": "FINISH - Cliente cancelou com reembolso",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": { 
				  "input": {
					"$ref": "bag.pizza.pagamento"
				  }
				}
			},			
			{
				"id": "FINISH - Cliente cancelou com reembolso",
				"type": "Finish",
				"name": "Finish - Cliente cancelou. Com reembolso",
				"lane_id": "pizzaria",
				"next": null
			},
			{
				"id": "FINISH - Cliente cancelou sem reembolso",
				"type": "Finish",
				"name": "Finish - Cliente cancelou. Sem reembolso",
				"lane_id": "pizzaria",
				"next": null
			},
			{
				"id": "NÃO É POSSÍVEL CANCELAR",
				"name": "Impossível cancelar - já foi aceito",
				"next": "ENTREGADOR CHEGOU?",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza.status"
				  }
				}
			},
			{
				"id": "ENTREGADOR CHEGOU?",
				"name": "Entregador chegou ao local de entrega?",
				"next": {
					"default": "PEDIDO ESTÁ CORRETO?",
					"true": "PEDIDO ESTÁ CORRETO?",
					"false": "ESPERAR ENTREGADOR POR 10 MIN"
					  },
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.entrega"
					  }
					  }
					}
			},
			{
				"id": "ESPERAR ENTREGADOR POR 10 MIN",
				"name": "Aguardar 10 min",
				"next": "CHECK STATUS",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "aguardar_pedido",
					"input": {
						"status_pizza": {"$ref": "bag.pizza.status"}					}
					}
			},
			{
				"id": "TEMPO MÉDIO PARA ENTREGA",
				"name": "Tempo médio para entrega do pedido",
				"next": "RESTAURANTE RECEBE O PEDIDO",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza.tempo"
				  }
				}
			},
			{
				"id": "RESTAURANTE RECEBE O PEDIDO",
				"name": "Entrega do Pedido a Pizzaria",
				"next": "ACEITAR O PEDIDO?",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza"
				  }
				}
			},
			{
				"id": "ACEITAR O PEDIDO?",
				"name": "Pizzaria aceita o pedido?",
				"next": {
					"default": "PREPARA O PEDIDO",
					"true": "PREPARA O PEDIDO",
					"false": "JÁ FOI PAGO? - pizzaria"
					  },
				"type": "flow",
				"lane_id": "pizzaria",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.aceite"
					  }
					  }
					}
			},
			{
				"id": "JÁ FOI PAGO? - pizzaria",
				"name": "Pizzaria Cancelou. Pizza já estava paga?",
				"next": {
					"default": "FINISH - pizzaria cancela sem reembolso",
					"true": "FINISH - pizzaria cancela sem reembolso",
					"false": "REEMBOLSO - pizzaria não fez a pizza"
						  },
				"type": "flow",
				"lane_id": "pizzaria",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.pagamento"
					  }
					  }
					}
			},
			{
				"id": "REEMBOLSO - pizzaria não fez a pizza",
				"name": "Reembolsar (pizzaria pediu cancelamento)",
				"next": "FINISH - pizzaria cancela com reembolso",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza.pagamento"
				  }
				}
			},
			{
				"id": "FINISH - pizzaria cancela com reembolso",
				"type": "Finish",
				"name": "Finish - Pizzaria cancelou. Com reembolso",
				"lane_id": "pizzaria",
				"next": null
			},
			{
				"id": "FINISH - pizzaria cancela sem reembolso",
				"type": "Finish",
				"name": "Finish - Pizzaria Cancelou. Sem reembolso",
				"lane_id": "pizzaria",
				"next": null
			},
			{
				"id": "PREPARA O PEDIDO",
				"name": "Preparar pizza",
				"next": "MONITORAMENTO DA PIZZARIA",
				"lane_id": "pizzaria",
				"type": "UserTask",
				"parameters": {
					"action": "preparar_pizza",
					"input": {
						"pedido_pizza": {"$ref": "bag.pizza"}	
					}
					}
			},
			{
				"id": "MONITORAMENTO DA PIZZARIA",
				"name": "Status da Pizzaria",
				"next": "IMPOSSÍVEL FINALIZAR PREPRAÇÃO?",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizzaria.monitoramento"
				  }
				}
			},
			{
				"id": "IMPOSSÍVEL FINALIZAR PREPRAÇÃO?",
				"name": "Algum problema que impossibilite a finalização do pedido?",
				"next": {
					"default": "FINALIZAR PREPARAÇÃO",
					"true": "FINALIZAR PREPARAÇÃO",
					"false": "JÁ FOI PAGO? - pizzaria"
						  },
				"type": "flow",
				"lane_id": "pizzaria",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizzaria.monitoramento"
					  }
					  }
					}
			},
			{
				"id": "FINALIZAR PREPARAÇÃO",
				"name": "Finalizar preparação",
				"next": "LIBERAR PARA ENTRAGA",
				"lane_id": "pizzaria",
				"type": "UserTask",
				"parameters": {
					"action": "revisar_pedido",
					"input": {
						"pedido_pizza": {"$ref": "bag.pizza"}					
					}
					}
			},
			{
				"id": "LIBERAR PARA ENTRAGA",
				"name": "libera o pedido para o setor de entrega",
				"next": "ORGANIZA PARA ENTREGA (OTIMIZADOR DE ROTAS)",
				"lane_id": "pizzaria",
				"type": "UserTask",
				"parameters": {
					"action": "libera_pizza",
					"input": {
						"pedido_pizza": {"$ref": "bag.pizza"}					
					}
					}
			},
			{
				"id": "ORGANIZA PARA ENTREGA (OTIMIZADOR DE ROTAS)",
				"name": "Organizar rota",
				"next": "ENTREGADOR RECOLHE PIZZA",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza.entrega"
				  }
				}
			},
			{
				"id": "ENTREGADOR RECOLHE PIZZA",
				"name": "Entregador recebe a pizza",
				"next": "ENTREGADOR CHEGA AO LOCAL DA ENTREGA",
				"lane_id": "pizzaria",
				"type": "UserTask",
				"parameters": {
					"action": "entregador_recolhe",
					"input": {
						"pedido_pizza": {"$ref": "bag.pizza"}					
					}
					}
			},
			{
				"id": "ENTREGADOR CHEGA AO LOCAL DA ENTREGA",
				"name": "Entregador chega ao cliente",
				"next": "PEDIDO ESTÁ CORRETO?",
				"lane_id": "pizzaria",
				"type": "UserTask",
				"parameters": {
					"action": "entregador_chega",
					"input": {
						"pedido_pizza": {"$ref": "bag.pizza"}					
					}
					}
			},
			{
				"id": "PEDIDO ESTÁ CORRETO?",
				"name": "Conferencia do pedido com o Cliente",
				"next": {
					"default": "JÁ FOI PAGO? - verificação na entrega",
					"true": "JÁ FOI PAGO? - verificação na entrega",
					"false": "JÁ FOI PAGO? - erro da pizzaria"
						  },
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza"
					  }
					  }
					}
			},
			{
				"id": "JÁ FOI PAGO? - erro da pizzaria",
				"name": "Verificar se houve pagamento - Erro da pizzaria",
				"next": {
					"default": "FINISH - entregador não reembolsa",
					"true": "FINISH - entregador não reembolsa",
					"false": "REEMBOLSO - erro da pizzaria"
						  },
				"type": "flow",
				"lane_id": "pizzaria",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.pagamento"
					  }
					  }
					}
			},
			{
				"id": "REEMBOLSO - erro da pizzaria",
				"name": "Rembolso - erro da pizzaria",
				"next": "FINISH - entregador reembolsa",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza.pagamento"
				  }
				}
			},
			{
				"id": "FINISH - entregador reembolsa",
				"type": "Finish",
				"name": "Finish - Falha ao entrega. Pizzaria Errou. Com reembolso",
				"lane_id": "pizzaria",
				"next": null
			},
			{
				"id": "FINISH - entregador não reembolsa",
				"type": "Finish",
				"name": "Finish - Falha ao entrega. Pizzaria Errou. Sem reembolso",
				"lane_id": "pizzaria",
				"next": null
			},
			{
				"id": "JÁ FOI PAGO? - verificação na entrega",
				"name": "Ao entregar a pizza, verificar se já foi pago",
				"next": {
					"default": "CLIENTE RECEBE A PIZZA",
					"true": "CLIENTE RECEBE A PIZZA",
					"false": "PAGAR - ao entregador"
						  },
				"type": "flow",
				"lane_id": "user",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.pagamento"
					  }
					  }
					}
			},
			{
				"id": "PAGAR - ao entregador",
				"name": "Cliente paga ao entregador",
				"next": "CLIENTE RECEBE A PIZZA",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "pagar_pizza",
					"input": {
						"pagamento_pizza": {"$ref": "bag.pizza.pagamento"}					
					}
					}
			},
			{
				"id": "CLIENTE RECEBE A PIZZA",
				"name": "Pizza entregue",
				"next": "VERIFICA O TEMPO DE ENTREGA",
				"lane_id": "user",
				"type": "UserTask",
				"parameters": {
					"action": "pizza_recebida",
					"input": {
						"pedido_pizza": {"$ref": "bag.pizza"}					
					}
					}
			},
			{
				"id": "VERIFICA O TEMPO DE ENTREGA",
				"name": "Verificar o tempo de entrega feito e esperado",
				"next": "ULTRAPASSOU O TEMPO ESPERADO?",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza.tempo"
				  }
				}
			},
			{
				"id": "ULTRAPASSOU O TEMPO ESPERADO?",
				"name": "any string",
				"next": {
					"default": "FINISH - entregue no prazo",
					"true": "FINISH - entregue no prazo",
					"false": "CUPOM DE DESCONTO/REGISTRA O ATRASO"
					  },
				"type": "flow",
				"lane_id": "pizzaria",
				"parameters": {
				  "input": {
					"key": {
						"$ref": "bag.pizza.tempo"
					  }
					  }
					}
			},
			{
				"id": "FINISH - entregue no prazo",
				"type": "Finish",
				"name": "Finish - Sucesso na entrega. Sucesso no prazo.",
				"lane_id": "pizzaria",
				"next": null
			},
			{
				"id": "CUPOM DE DESCONTO/REGISTRA O ATRASO",
				"name": "Desconto por entregar fora do prazo",
				"next": "FINISH - entregue fora do prazo",
				"lane_id": "pizzaria",
				"type": "SystemTask",
				"category": "setToBag",
				"parameters": {
				  "input": {
					"$ref": "bag.pizza.cupom"
				  }
				}		  
			},
			{
				"id": "FINISH - entregue fora do prazo",
				"type": "Finish",
				"name": "Finish - Sucesso na entrega. Falha no prazo. Cupom.",
				"lane_id": "pizzaria",
				"next": null
			}
		]
	}
}
